pipeline {
    agent any
    stages {
        stage('Run Tests') {
            steps {
                script {
                    sh """
                    #!/bin/bash

                    echo "Running tests..."

                    # Check if WordPress is running
                    if curl -s http://localhost:9090 | grep -q "WordPress"; then
                        echo "WordPress is running"
                    else
                        echo "WordPress is not running"
                        exit 1
                    fi

                    # Database connection test
                    if docker exec -it mysql_container mysqladmin ping -hlocalhost -uroot -p"root_password"; then
                        echo "Database is reachable"
                    else
                        echo "Database is not reachable"
                        exit 1
                    fi

                    echo "All tests passed!"
                    """
                }
            }
        }
    }
}
